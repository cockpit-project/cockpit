#!/usr/bin/env python

import testlib

import glob
import imp
import os
import string
import sys
import unittest

sys.dont_write_bytecode = True

loader = unittest.TestLoader()
suite = unittest.TestSuite()

def check_valid(filename):
    if filename == "check-verify":
        return False
    allowed = string.ascii_letters + string.digits + '-_'
    return all(c in allowed for c in filename)

# Load all modules that start with check-
for filename in glob.glob("check-*"):
    if not check_valid(filename) or not os.path.isfile(filename):
        continue
    name = filename.replace("-", "_")
    with open(filename, 'rb') as fp:
        module = imp.load_module(name, fp, filename, ("", "rb", imp.PY_SOURCE))
        suite.addTests(loader.loadTestsFromModule(module))

# And now run all the tests we got
testlib.test_main(suite)
