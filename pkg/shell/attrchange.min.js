define(['jquery'],function($){function isDOMAttrModifiedSupported(){var p=document.createElement("p");var flag=false;if(p.addEventListener)p.addEventListener("DOMAttrModified",function(){flag=true},false);else if(p.attachEvent)p.attachEvent("onDOMAttrModified",function(){flag=true});else return false;p.setAttribute("id","target");return flag}function checkAttributes(chkAttr,e){if(chkAttr){var attributes=this.data("attr-old-value");if(e.attributeName.indexOf("style")>=0){if(!attributes["style"])attributes["style"]={};var keys=e.attributeName.split(".");e.attributeName=keys[0];e.oldValue=attributes["style"][keys[1]];e.newValue=keys[1]+":"+this.prop("style")[$.camelCase(keys[1])];attributes["style"][keys[1]]=e.newValue}else{e.oldValue=attributes[e.attributeName];e.newValue=this.attr(e.attributeName);attributes[e.attributeName]=e.newValue}this.data("attr-old-value",attributes)}}var MutationObserver=window.MutationObserver||window.WebKitMutationObserver;$.fn.attrchange=function(o){var cfg={trackValues:false,callback:$.noop};if(typeof o==="function"){cfg.callback=o}else{$.extend(cfg,o)}if(cfg.trackValues){$(this).each(function(unused,el){var attributes={};for(var attr,i=0,attrs=el.attributes,l=attrs.length;i<l;i++){attr=attrs.item(i);attributes[attr.nodeName]=attr.value}$(this).data("attr-old-value",attributes)})}if(MutationObserver){var mOptions={subtree:false,attributes:true,attributeOldValue:cfg.trackValues};var observer=new MutationObserver(function(mutations){mutations.forEach(function(e){var _this=e.target;if(cfg.trackValues){e.newValue=$(_this).attr(e.attributeName)}cfg.callback.call(_this,e)})});return this.each(function(){observer.observe(this,mOptions)})}else if(isDOMAttrModifiedSupported()){return this.on("DOMAttrModified",function(event){if(event.originalEvent)event=event.originalEvent;event.attributeName=event.attrName;event.oldValue=event.prevValue;cfg.callback.call(this,event)})}else if("onpropertychange"in document.body){return this.on("propertychange",function(e){e.attributeName=window.event.propertyName;checkAttributes.call($(this),cfg.trackValues,e);cfg.callback.call(this,e)})}return this}});
