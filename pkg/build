#!/usr/bin/make -f

# Need some reasonable defaults in case we're run standalone
srcdir ?= .
AM_DEFAULT_VERBOSITY ?= 0
NODE_ENV ?= production

# one built file in dist/ which we use as dependency
DIST_STAMP = $(srcdir)/dist/static/manifest.json

V_WEBPACK = $(V_WEBPACK_$(V))
V_WEBPACK_ = $(V_WEBPACK_$(AM_DEFAULT_VERBOSITY))
V_WEBPACK_0 = @echo "  WEBPACK  dist";

$(DIST_STAMP): $(srcdir)/package-lock.json
	$(V_WEBPACK) cd $(srcdir) && NODE_ENV='$(NODE_ENV)' tools/termschutz -- tools/webpack-make.js --test-mtime "$(DIST_STAMP)"

node_modules/%: $(srcdir)/package-lock.json
	@true

EXTRA_DIST += webpack.config.js package.json package-lock.json
