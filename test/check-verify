#!/usr/bin/env python

import testlib

import glob
import imp
import os
import string
import sys
import unittest

sys.dont_write_bytecode = True

base = os.path.dirname(__file__)
loader = unittest.TestLoader()
suite = unittest.TestSuite()

exclude = [
    'check-verify',
    'check-example'
]

def check_valid(filename):
    name = os.path.basename(filename)
    if name in exclude:
        return None
    allowed = string.ascii_letters + string.digits + '-_'
    if not all(c in allowed for c in name):
        return None
    return name.replace("-", "_")

# Load all modules that start with check-
for filename in glob.glob(os.path.join(base, "check-*")):
    name = check_valid(filename)
    if not name or not os.path.isfile(filename):
        continue
    with open(filename, 'rb') as fp:
        module = imp.load_module(name, fp, filename, ("", "rb", imp.PY_SOURCE))
        suite.addTest(loader.loadTestsFromModule(module))

# And now run all the tests we got
testlib.test_main(suite)
